/*! drag-drop-polyfill 2.0.0-beta.3 | Copyright (c) 2017 Tim Ruffles | BSD 2 License */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.DragDropPolyfill=t.DragDropPolyfill||{})}(this,function(t){"use strict";function e(){var t={dragEvents:"ondragstart"in document.documentElement,draggable:"draggable"in document.documentElement,touchEvents:"ontouchstart"in document.documentElement,userAgentSupportingNativeDnD:void 0},e=!!window.chrome||/chrome/i.test(navigator.userAgent);return t.userAgentSupportingNativeDnD=!(/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||e&&t.touchEvents),M&&Object.keys(t).forEach(function(e){console.log("dnd-poly: detected feature '"+e+" = "+t[e]+"'")}),t}function r(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(r){}return t}function a(t){if(t&&Object.keys(t).forEach(function(e){B[e]=t[e]}),!B.forceApply){var a=e();if(a.userAgentSupportingNativeDnD&&a.draggable&&a.dragEvents)return}console.log("dnd-poly: Applying mobile drag and drop polyfill."),U=r(),s("touchstart",o,!1)}function o(t){if(console.log("dnd-poly: global touchstart"),z)return void console.log("dnd-poly: drag operation already active");var e=n(t);if(e)try{z=new Z(t,B,e,i)}catch(r){throw i(B,t,3),r}}function n(t){var e=t.target;do if(e.draggable!==!1&&e.getAttribute&&"true"===e.getAttribute("draggable"))return e;while((e=e.parentNode)&&e!==document.body)}function i(t,e,r){if(0===r&&(console.log("dnd-poly: Drag never started. Last event was "+e.type),t.defaultActionOverride))try{t.defaultActionOverride(e),e.defaultPrevented&&console.log("dnd-poly: defaultActionOverride has taken care of triggering the default action. preventing default on original event")}catch(a){console.log("dnd-poly: error in defaultActionOverride: "+a)}z=null}function s(t,e,r){void 0===r&&(r=!0),document.addEventListener(t,e,U?{passive:r}:!1)}function d(t,e){document.removeEventListener(t,e)}function c(t){return 0===t.length?0:t.reduce(function(t,e){return e+t},0)/t.length}function l(t){return t&&t.tagName}function h(t,e){for(var r=0;r<t.changedTouches.length;r++){var a=t.changedTouches[r];if(a.identifier===e)return!0}return!1}function g(t,e,r,a,o,n,i){void 0===i&&(i=null);var s=e.changedTouches[0],d=new Event(r,{bubbles:!0,cancelable:a});d.dataTransfer=n,d.relatedTarget=i,d.screenX=s.screenX,d.screenY=s.screenY,d.clientX=s.clientX,d.clientY=s.clientY,d.pageX=s.pageX,d.pageY=s.pageY;var c=t.getBoundingClientRect();return d.offsetX=d.clientX-c.left,d.offsetY=d.clientY-c.top,d}function u(t,e,r){for(var a=[],o=[],n=0;n<e.touches.length;n++){var i=e.touches[n];a.push(i[t+"X"]),o.push(i[t+"Y"])}r.x=c(a),r.y=c(o)}function f(t,e){if(1===t.nodeType){for(var r=getComputedStyle(t),a=0;a<r.length;a++){var o=r[a];e.style.setProperty(o,r.getPropertyValue(o),r.getPropertyPriority(o))}e.style.pointerEvents="none",e.removeAttribute("id"),e.removeAttribute("class"),e.removeAttribute("draggable")}if(t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++)f(t.childNodes[a],e.childNodes[a])}function _(t){var e=t.cloneNode(!0);return f(t,e),e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex="999999",e.classList.add(J),e.classList.add(Q),e}function p(t){return V.map(function(e){var r=t.style[e+"transform"];return r&&"none"!==r?r.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,""):""})}function m(t,e,r,a,o){void 0===o&&(o=!0);var n=e.x,i=e.y;a&&(n+=a.x,i+=a.y),o&&(n-=parseInt(t.offsetWidth,10)/2,i-=parseInt(t.offsetHeight,10)/2);for(var s="translate3d("+n+"px,"+i+"px, 0)",d=0;d<V.length;d++){var c=V[d]+"transform";t.style[c]=s+" "+r[d]}}function v(t,e,r,a){var o=getComputedStyle(t);if("hidden"===o.visibility||"none"===o.display)return console.log("dnd-poly: source node is not visible. skipping snapback transition."),void a();console.log("dnd-poly: starting dragimage snap back");var n=t.getBoundingClientRect(),i={x:n.left,y:n.top};i.x+=document.body.scrollLeft||document.documentElement.scrollLeft,i.y+=document.body.scrollTop||document.documentElement.scrollTop,i.x-=parseInt(o.marginLeft,10),i.y-=parseInt(o.marginTop,10),e.classList.add(K);var s=getComputedStyle(e),d=parseFloat(s.transitionDuration),c=parseFloat(s.transitionDelay),l=Math.round(1e3*(d+c));m(e,i,r,void 0,!1),setTimeout(a,l)}function y(t,e){return t?t===R[0]?G[0]:0===t.indexOf(R[1])||t===R[7]?G[1]:0===t.indexOf(R[4])?G[3]:t===R[6]?G[2]:G[1]:3===e.nodeType&&"A"===e.tagName?G[3]:G[1]}function T(t,e,r,a,o,n,i){if(void 0===n&&(n=!0),void 0===i&&(i=null),console.log("dnd-poly: dispatching "+t),M){var s=q+"debug",d=q+"event-target",c=q+"event-related-target";e.classList.add(s),e.classList.add(d),i&&(i.classList.add(s),i.classList.add(c))}var l=g(e,r,t,n,document.defaultView,o,i),h=!e.dispatchEvent(l);return a._mode=0,M&&(e.classList.remove(d),i&&i.classList.remove(c)),h}function D(t,e){if(!t||t===R[7])return e;if(e===G[1]){if(0===t.indexOf(G[1]))return G[1]}else if(e===G[3]){if(0===t.indexOf(G[3])||t.indexOf("Link")>-1)return G[3]}else if(e===G[2]&&(0===t.indexOf(G[2])||t.indexOf("Move")>-1))return G[2];return G[0]}function O(t,e,r,a){Y=e,W=a,j!==r&&(j=r,F=A(j));var o=E(Y,F,et.threshold,rt,at);o?S():X&&(window.cancelAnimationFrame(X),X=null)}function S(){X||(X=window.requestAnimationFrame(I))}function I(){var t=0,e=0,r=b(F);0!==rt.horizontal&&(t=Math.round(et.velocityFn(at.x,et.threshold)*rt.horizontal),w(F,0,t)),0!==rt.vertical&&(e=Math.round(et.velocityFn(at.y,et.threshold)*rt.vertical),w(F,1,e)),r?W(t,e):W(0,0),X=null,E(Y,F,et.threshold,rt,at)&&S()}function E(t,e,r,a,o){if(!t||!e)return!1;var n={x:x(e,0),y:x(e,1),width:C(e,0),height:C(e,1),scrollX:w(e,0),scrollY:w(e,1),scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight},i={x:t.x-n.x,y:t.y-n.y};return a.horizontal=H(i.x,n.width,r),a.vertical=H(i.y,n.height,r),a.horizontal&&k(0,a.horizontal,n)?a.horizontal=0:a.horizontal&&(o.x=P(a.horizontal,i.x,n.width,r)),a.vertical&&k(1,a.vertical,n)?a.vertical=0:a.vertical&&(o.y=P(a.vertical,i.y,n.height,r)),!(!a.horizontal&&!a.vertical)}function b(t){return t===document.body||t===document.documentElement}function x(t,e){var r;if(b(t))r=0===e?t.clientLeft:t.clientTop;else{var a=t.getBoundingClientRect();r=0===e?a.left:a.top}return r}function C(t,e){var r;return r=b(t)?0===e?window.innerWidth:window.innerHeight:0===e?t.clientWidth:t.clientHeight}function w(t,e,r){var a=0===e?"scrollLeft":"scrollTop",o=b(t);return 2===arguments.length?o?document.body[a]||document.documentElement[a]:t[a]:void(o?(document.documentElement[a]+=r,document.body[a]+=r):t[a]+=r)}function L(t){var e=getComputedStyle(t);return t.scrollHeight>t.clientHeight&&("scroll"===e.overflowY||"auto"===e.overflowY)?!0:t.scrollWidth>t.clientWidth&&("scroll"===e.overflowX||"auto"===e.overflowX)?!0:!1}function A(t){do{if(!t)return void 0;if(L(t))return t;if(t===document.documentElement)return null}while(t=t.parentNode);return null}function H(t,e,r){return r>t?-1:r>e-t?1:0}function P(t,e,r,a){return-1===t?Math.abs(e-a):1===t?Math.abs(r-e-a):0}function k(t,e,r){var a=0===t?r.scrollX:r.scrollY;if(1===e){var o=0===t?r.scrollWidth-r.width:r.scrollHeight-r.height;return a>=o}return-1===e?0>=a:!0}function N(t){Object.keys(t).forEach(function(e){et[e]=t[e]})}var M,U,z,X,Y,j,F,W,B={iterationInterval:150},R=["none","copy","copyLink","copyMove","link","linkMove","move","all"],G=["none","copy","move","link"],V=["","-webkit-"],q="dnd-poly-",J=q+"drag-image",K=q+"snapback",Q=q+"icon",Z=function(){function t(t,e,r,a){this._initialEvent=t,this._config=e,this._sourceNode=r,this._dragOperationEndedCb=a,this._dragOperationState=0,this._immediateUserSelection=null,this._currentDropTarget=null,console.log("dnd-poly: setting up potential drag operation.."),this._lastTouchEvent=t,this._initialTouch=t.changedTouches[0],this._touchMoveHandler=this._onTouchMove.bind(this),this._touchEndOrCancelHandler=this._onTouchEndOrCancel.bind(this),s("touchmove",this._touchMoveHandler,!1),s("touchend",this._touchEndOrCancelHandler,!1),s("touchcancel",this._touchEndOrCancelHandler,!1)}return t.prototype._setup=function(){var t=this;console.log("dnd-poly: starting drag and drop operation"),this._dragOperationState=1,this._currentDragOperation=G[0],this._dragDataStore={_data:{},_effectAllowed:void 0,_mode:3,_types:[]},this._currentHotspotCoordinates={x:null,y:null},this._dragImagePageCoordinates={x:null,y:null};var e=this._sourceNode;if(this._dataTransfer=new $(this._dragDataStore,function(r,a,o){e=r,("number"==typeof a||"number"==typeof o)&&(t._dragImageOffset={x:a||0,y:o||0})}),this._dragDataStore._mode=2,this._dataTransfer.dropEffect=G[0],T("dragstart",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer))return console.log("dnd-poly: dragstart cancelled"),this._dragOperationState=3,this._cleanup(),!1;if(u("page",this._lastTouchEvent,this._dragImagePageCoordinates),this._dragImage=_(e),this._dragImageTransforms=p(this._dragImage),!this._dragImageOffset)if(this._config.dragImageOffset)this._dragImageOffset={x:this._config.dragImageOffset.x,y:this._config.dragImageOffset.y};else if(this._config.dragImageCenterOnTouch){var r=getComputedStyle(e);this._dragImageOffset={x:0-parseInt(r.marginLeft,10),y:0-parseInt(r.marginTop,10)}}else{var a=e.getBoundingClientRect(),r=getComputedStyle(e);this._dragImageOffset={x:a.left-this._initialTouch.clientX-parseInt(r.marginLeft,10)+a.width/2,y:a.top-this._initialTouch.clientY-parseInt(r.marginTop,10)+a.height/2}}return m(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch),document.body.appendChild(this._dragImage),this._iterationIntervalId=setInterval(function(){return t._iterationLock?void console.log("dnd-poly: iteration skipped because previous iteration hast not yet finished."):(t._iterationLock=!0,t._dragAndDropProcessModelIteration(),void(t._iterationLock=!1))},this._config.iterationInterval),!0},t.prototype._cleanup=function(){console.log("dnd-poly: cleanup"),this._iterationIntervalId&&(clearInterval(this._iterationIntervalId),this._iterationIntervalId=null),d("touchmove",this._touchMoveHandler),d("touchend",this._touchEndOrCancelHandler),d("touchcancel",this._touchEndOrCancelHandler),this._dragImage&&(this._dragImage.parentNode.removeChild(this._dragImage),this._dragImage=null),this._dragOperationEndedCb(this._config,this._lastTouchEvent,this._dragOperationState)},t.prototype._onTouchMove=function(t){var e=this;if(h(t,this._initialTouch.identifier)!==!1){if(this._lastTouchEvent=t,0===this._dragOperationState){var r=void 0;if(this._config.dragStartConditionOverride)try{r=this._config.dragStartConditionOverride(t)}catch(a){console.error("dnd-poly: error in dragStartConditionOverride hook: "+a),r=!1}else r=1===t.touches.length;return r?void(this._setup()===!0&&(this._initialEvent.preventDefault(),t.preventDefault())):void this._cleanup()}if(console.log("dnd-poly: moving draggable.."),t.preventDefault(),u("client",t,this._currentHotspotCoordinates),u("page",t,this._dragImagePageCoordinates),this._config.dragImageTranslateOverride)try{var o=!1;if(this._config.dragImageTranslateOverride(t,{x:this._currentHotspotCoordinates.x,y:this._currentHotspotCoordinates.y},this._immediateUserSelection,function(t,r){e._dragImage&&(o=!0,e._currentHotspotCoordinates.x+=t,e._currentHotspotCoordinates.y+=r,e._dragImagePageCoordinates.x+=t,e._dragImagePageCoordinates.y+=r,m(e._dragImage,e._dragImagePageCoordinates,e._dragImageTransforms,e._dragImageOffset,e._config.dragImageCenterOnTouch))}),o)return}catch(a){console.log("dnd-poly: error in dragImageTranslateOverride hook: "+a)}m(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch)}},t.prototype._onTouchEndOrCancel=function(t){if(h(t,this._initialTouch.identifier)!==!1){if(this._config.dragImageTranslateOverride)try{this._config.dragImageTranslateOverride(void 0,void 0,void 0,function(){})}catch(e){console.log("dnd-poly: error in dragImageTranslateOverride hook: "+e)}if(0===this._dragOperationState)return void this._cleanup();t.preventDefault(),this._dragOperationState="touchcancel"===t.type?3:2}},t.prototype._dragAndDropProcessModelIteration=function(){var t=this;if(M)var e=q+"debug",r=q+"immediate-user-selection",a=q+"current-drop-target";var o=this._currentDragOperation;this._dragDataStore._mode=3,this._dataTransfer.dropEffect=G[0];var n=T("drag",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer);if(n&&(console.log("dnd-poly: drag event cancelled."),this._currentDragOperation=G[0]),n||2===this._dragOperationState||3===this._dragOperationState){var i=this._dragOperationEnded(this._dragOperationState);return i?void v(this._sourceNode,this._dragImage,this._dragImageTransforms,function(){t._finishDragOperation()}):void this._finishDragOperation()}var s=document.elementFromPoint(this._currentHotspotCoordinates.x,this._currentHotspotCoordinates.y);console.log("dnd-poly: new immediate user selection is: "+s);var d=this._currentDropTarget;s!==this._immediateUserSelection&&s!==this._currentDropTarget&&(M&&(this._immediateUserSelection&&this._immediateUserSelection.classList.remove(r),s&&(s.classList.add(e),s.classList.add(r))),this._immediateUserSelection=s,null!==this._currentDropTarget&&(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=G[0],T("dragexit",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)),null===this._immediateUserSelection?(this._currentDropTarget=this._immediateUserSelection,console.log("dnd-poly: current drop target changed to null")):(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=y(this._dragDataStore._effectAllowed,this._sourceNode),T("dragenter",this._immediateUserSelection,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?(console.log("dnd-poly: dragenter default prevented"),this._currentDropTarget=this._immediateUserSelection,this._currentDragOperation=D(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect)):this._immediateUserSelection!==document.body&&(this._currentDropTarget=document.body))),d!==this._currentDropTarget&&l(d)&&(M&&d.classList.remove(a),console.log("dnd-poly: current drop target changed."),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=G[0],T("dragleave",d,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1,this._currentDropTarget)),l(this._currentDropTarget)&&(M&&(this._currentDropTarget.classList.add(e),this._currentDropTarget.classList.add(a)),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=y(this._dragDataStore._effectAllowed,this._sourceNode),T("dragover",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)===!1?(console.log("dnd-poly: dragover not prevented on possible drop-target."),this._currentDragOperation=G[0]):(console.log("dnd-poly: dragover prevented."),this._currentDragOperation=D(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect))),console.log("dnd-poly: d'n'd iteration ended. current drag operation: "+this._currentDragOperation),o!==this._currentDragOperation&&this._dragImage.classList.remove(q+o);var c=q+this._currentDragOperation;this._dragImage.classList.contains(c)===!1&&this._dragImage.classList.add(c)},t.prototype._dragOperationEnded=function(t){if(console.log("dnd-poly: drag operation end detected with "+this._currentDragOperation),M){var e=q+"immediate-user-selection",r=q+"current-drop-target";this._currentDropTarget&&this._currentDropTarget.classList.remove(r),this._immediateUserSelection&&this._immediateUserSelection.classList.remove(e)}var a=this._currentDragOperation===G[0]||null===this._currentDropTarget||3===t;return a?l(this._currentDropTarget)&&(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=G[0],T("dragleave",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)):l(this._currentDropTarget)&&(this._dragDataStore._mode=1,this._dataTransfer.dropEffect=this._currentDragOperation,this._currentDragOperation=T("drop",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)===!0?this._dataTransfer.dropEffect:G[0]),a},t.prototype._finishDragOperation=function(){console.log("dnd-poly: dragimage snap back transition ended"),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=this._currentDragOperation,T("dragend",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1),this._dragOperationState=2,this._cleanup()},t}(),$=function(){function t(t,e){this._dataStore=t,this._setDragImageHandler=e,this._dropEffect=G[0]}return Object.defineProperty(t.prototype,"types",{get:function(){return 0!==this._dataStore._mode?Object.freeze(this._dataStore._types):void 0},enumerable:!0,configurable:!0}),t.prototype.setData=function(t,e){if(2===this._dataStore._mode){if(t.indexOf(" ")>-1)throw new Error("illegal arg: type contains space");this._dataStore._data[t]=e,-1===this._dataStore._types.indexOf(t)&&this._dataStore._types.push(t)}},t.prototype.getData=function(t){return 1===this._dataStore._mode||2===this._dataStore._mode?this._dataStore._data[t]||"":void 0},t.prototype.clearData=function(t){if(2===this._dataStore._mode){if(t&&this._dataStore._data[t]){delete this._dataStore._data[t];var e=this._dataStore._types.indexOf(t);return void(e>-1&&this._dataStore._types.splice(e,1))}this._dataStore._data={},this._dataStore._types=[]}},t.prototype.setDragImage=function(t,e,r){2===this._dataStore._mode&&this._setDragImageHandler(t,e,r)},Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._dataStore._effectAllowed},set:function(t){2===this._dataStore._mode&&R.indexOf(t)>-1&&(this._dataStore._effectAllowed=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){0!==this._dataStore._mode&&R.indexOf(t)>-1&&(this._dropEffect=t)},enumerable:!0,configurable:!0}),t}(),tt={DEBUG:M,Initialize:a},et={threshold:75,velocityFn:function(t,e){var r=t/e,a=r*r*r;return a*e}},rt={horizontal:0,vertical:0},at={x:0,y:0},ot=O,nt={DEBUG:tt.DEBUG,Initialize:tt.Initialize,SetOptions:N};t.HandleDragImageTranslateOverride=ot,t.DragDropPolyfill=nt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=drag-drop-polyfill-scroll-behaviour.min.js.map