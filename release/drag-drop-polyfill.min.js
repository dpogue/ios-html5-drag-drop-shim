/*! drag-drop-polyfill 2.0.0-beta.3 | Copyright (c) 2017 Tim Ruffles | BSD 2 License */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.DragDropPolyfill=t.DragDropPolyfill||{})}(this,function(t){"use strict";function e(){var t={dragEvents:"ondragstart"in document.documentElement,draggable:"draggable"in document.documentElement,touchEvents:"ontouchstart"in document.documentElement,userAgentSupportingNativeDnD:void 0},e=!!window.chrome||/chrome/i.test(navigator.userAgent);return t.userAgentSupportingNativeDnD=!(/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||e&&t.touchEvents),O&&Object.keys(t).forEach(function(e){console.log("dnd-poly: detected feature '"+e+" = "+t[e]+"'")}),t}function r(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(r){}return t}function a(t){if(t&&Object.keys(t).forEach(function(e){E[e]=t[e]}),!E.forceApply){var a=e();if(a.userAgentSupportingNativeDnD&&a.draggable&&a.dragEvents)return}console.log("dnd-poly: Applying mobile drag and drop polyfill."),S=r(),s("touchstart",o,!1)}function o(t){if(O&&console.log("dnd-poly: global touchstart"),I)return void(O&&console.log("dnd-poly: drag operation already active"));var e=n(t);if(e)try{I=new k(t,E,e,i)}catch(r){throw i(E,t,3),r}}function n(t){var e=t.target;do if(e.draggable!==!1&&e.getAttribute&&"true"===e.getAttribute("draggable"))return e;while((e=e.parentNode)&&e!==document.body)}function i(t,e,r){if(0===r&&(O&&console.log("dnd-poly: Drag never started. Last event was "+e.type),t.defaultActionOverride))try{t.defaultActionOverride(e),e.defaultPrevented&&O&&console.log("dnd-poly: defaultActionOverride has taken care of triggering the default action. preventing default on original event")}catch(a){O&&console.log("dnd-poly: error in defaultActionOverride: "+a)}I=null}function s(t,e,r){void 0===r&&(r=!0),document.addEventListener(t,e,S?{passive:r}:!1)}function d(t,e){document.removeEventListener(t,e)}function c(t){return 0===t.length?0:t.reduce(function(t,e){return e+t},0)/t.length}function l(t){return t&&t.tagName}function g(t,e){for(var r=0;r<t.changedTouches.length;r++){var a=t.changedTouches[r];if(a.identifier===e)return!0}return!1}function h(t,e,r,a,o,n,i){void 0===i&&(i=null);var s=e.changedTouches[0],d=new Event(r,{bubbles:!0,cancelable:a});d.dataTransfer=n,d.relatedTarget=i,d.screenX=s.screenX,d.screenY=s.screenY,d.clientX=s.clientX,d.clientY=s.clientY,d.pageX=s.pageX,d.pageY=s.pageY;var c=t.getBoundingClientRect();return d.offsetX=d.clientX-c.left,d.offsetY=d.clientY-c.top,d}function u(t,e,r){for(var a=[],o=[],n=0;n<e.touches.length;n++){var i=e.touches[n];a.push(i[t+"X"]),o.push(i[t+"Y"])}r.x=c(a),r.y=c(o)}function _(t,e){if(1===t.nodeType){for(var r=getComputedStyle(t),a=0;a<r.length;a++){var o=r[a];e.style.setProperty(o,r.getPropertyValue(o),r.getPropertyPriority(o))}e.style.pointerEvents="none",e.removeAttribute("id"),e.removeAttribute("class"),e.removeAttribute("draggable")}if(t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++)_(t.childNodes[a],e.childNodes[a])}function f(t){var e=t.cloneNode(!0);return _(t,e),e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex="999999",e.classList.add(A),e.classList.add(w),e}function p(t){return x.map(function(e){var r=t.style[e+"transform"];return r&&"none"!==r?r.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,""):""})}function m(t,e,r,a,o){void 0===o&&(o=!0);var n=e.x,i=e.y;a&&(n+=a.x,i+=a.y),o&&(n-=parseInt(t.offsetWidth,10)/2,i-=parseInt(t.offsetHeight,10)/2);for(var s="translate3d("+n+"px,"+i+"px, 0)",d=0;d<x.length;d++){var c=x[d]+"transform";t.style[c]=s+" "+r[d]}}function v(t,e,r,a){var o=getComputedStyle(t);if("hidden"===o.visibility||"none"===o.display)return O&&console.log("dnd-poly: source node is not visible. skipping snapback transition."),void a();O&&console.log("dnd-poly: starting dragimage snap back");var n=t.getBoundingClientRect(),i={x:n.left,y:n.top};i.x+=document.body.scrollLeft||document.documentElement.scrollLeft,i.y+=document.body.scrollTop||document.documentElement.scrollTop,i.x-=parseInt(o.marginLeft,10),i.y-=parseInt(o.marginTop,10),e.classList.add(P);var s=getComputedStyle(e),d=parseFloat(s.transitionDuration),c=parseFloat(s.transitionDelay),l=Math.round(1e3*(d+c));m(e,i,r,void 0,!1),setTimeout(a,l)}function y(t,e){return t?t===b[0]?C[0]:0===t.indexOf(b[1])||t===b[7]?C[1]:0===t.indexOf(b[4])?C[3]:t===b[6]?C[2]:C[1]:3===e.nodeType&&"A"===e.tagName?C[3]:C[1]}function T(t,e,r,a,o,n,i){if(void 0===n&&(n=!0),void 0===i&&(i=null),O&&console.log("dnd-poly: dispatching "+t),O){var s=L+"debug",d=L+"event-target",c=L+"event-related-target";e.classList.add(s),e.classList.add(d),i&&(i.classList.add(s),i.classList.add(c))}var l=h(e,r,t,n,document.defaultView,o,i),g=!e.dispatchEvent(l);return a._mode=0,O&&(e.classList.remove(d),i&&i.classList.remove(c)),g}function D(t,e){if(!t||t===b[7])return e;if(e===C[1]){if(0===t.indexOf(C[1]))return C[1]}else if(e===C[3]){if(0===t.indexOf(C[3])||t.indexOf("Link")>-1)return C[3]}else if(e===C[2]&&(0===t.indexOf(C[2])||t.indexOf("Move")>-1))return C[2];return C[0]}var O,S,I,E={iterationInterval:150},b=["none","copy","copyLink","copyMove","link","linkMove","move","all"],C=["none","copy","move","link"],x=["","-webkit-"],L="dnd-poly-",A=L+"drag-image",P=L+"snapback",w=L+"icon",k=function(){function t(t,e,r,a){this._initialEvent=t,this._config=e,this._sourceNode=r,this._dragOperationEndedCb=a,this._dragOperationState=0,this._immediateUserSelection=null,this._currentDropTarget=null,O&&console.log("dnd-poly: setting up potential drag operation.."),this._lastTouchEvent=t,this._initialTouch=t.changedTouches[0],this._touchMoveHandler=this._onTouchMove.bind(this),this._touchEndOrCancelHandler=this._onTouchEndOrCancel.bind(this),s("touchmove",this._touchMoveHandler,!1),s("touchend",this._touchEndOrCancelHandler,!1),s("touchcancel",this._touchEndOrCancelHandler,!1)}return t.prototype._setup=function(){var t=this;O&&console.log("dnd-poly: starting drag and drop operation"),this._dragOperationState=1,this._currentDragOperation=C[0],this._dragDataStore={_data:{},_effectAllowed:void 0,_mode:3,_types:[]},this._currentHotspotCoordinates={x:null,y:null},this._dragImagePageCoordinates={x:null,y:null};var e=this._sourceNode;if(this._dataTransfer=new N(this._dragDataStore,function(r,a,o){e=r,("number"==typeof a||"number"==typeof o)&&(t._dragImageOffset={x:a||0,y:o||0})}),this._dragDataStore._mode=2,this._dataTransfer.dropEffect=C[0],T("dragstart",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer))return O&&console.log("dnd-poly: dragstart cancelled"),this._dragOperationState=3,this._cleanup(),!1;if(u("page",this._lastTouchEvent,this._dragImagePageCoordinates),this._dragImage=f(e),this._dragImageTransforms=p(this._dragImage),!this._dragImageOffset)if(this._config.dragImageOffset)this._dragImageOffset={x:this._config.dragImageOffset.x,y:this._config.dragImageOffset.y};else if(this._config.dragImageCenterOnTouch){var r=getComputedStyle(e);this._dragImageOffset={x:0-parseInt(r.marginLeft,10),y:0-parseInt(r.marginTop,10)}}else{var a=e.getBoundingClientRect(),r=getComputedStyle(e);this._dragImageOffset={x:a.left-this._initialTouch.clientX-parseInt(r.marginLeft,10)+a.width/2,y:a.top-this._initialTouch.clientY-parseInt(r.marginTop,10)+a.height/2}}return m(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch),document.body.appendChild(this._dragImage),this._iterationIntervalId=setInterval(function(){return t._iterationLock?void(O&&console.log("dnd-poly: iteration skipped because previous iteration hast not yet finished.")):(t._iterationLock=!0,t._dragAndDropProcessModelIteration(),void(t._iterationLock=!1))},this._config.iterationInterval),!0},t.prototype._cleanup=function(){O&&console.log("dnd-poly: cleanup"),this._iterationIntervalId&&(clearInterval(this._iterationIntervalId),this._iterationIntervalId=null),d("touchmove",this._touchMoveHandler),d("touchend",this._touchEndOrCancelHandler),d("touchcancel",this._touchEndOrCancelHandler),this._dragImage&&(this._dragImage.parentNode.removeChild(this._dragImage),this._dragImage=null),this._dragOperationEndedCb(this._config,this._lastTouchEvent,this._dragOperationState)},t.prototype._onTouchMove=function(t){var e=this;if(g(t,this._initialTouch.identifier)!==!1){if(this._lastTouchEvent=t,0===this._dragOperationState){var r=void 0;if(this._config.dragStartConditionOverride)try{r=this._config.dragStartConditionOverride(t)}catch(a){console.error("dnd-poly: error in dragStartConditionOverride hook: "+a),r=!1}else r=1===t.touches.length;return r?void(this._setup()===!0&&(this._initialEvent.preventDefault(),t.preventDefault())):void this._cleanup()}if(O&&console.log("dnd-poly: moving draggable.."),t.preventDefault(),u("client",t,this._currentHotspotCoordinates),u("page",t,this._dragImagePageCoordinates),this._config.dragImageTranslateOverride)try{var o=!1;if(this._config.dragImageTranslateOverride(t,{x:this._currentHotspotCoordinates.x,y:this._currentHotspotCoordinates.y},this._immediateUserSelection,function(t,r){e._dragImage&&(o=!0,e._currentHotspotCoordinates.x+=t,e._currentHotspotCoordinates.y+=r,e._dragImagePageCoordinates.x+=t,e._dragImagePageCoordinates.y+=r,m(e._dragImage,e._dragImagePageCoordinates,e._dragImageTransforms,e._dragImageOffset,e._config.dragImageCenterOnTouch))}),o)return}catch(a){O&&console.log("dnd-poly: error in dragImageTranslateOverride hook: "+a)}m(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch)}},t.prototype._onTouchEndOrCancel=function(t){if(g(t,this._initialTouch.identifier)!==!1){if(this._config.dragImageTranslateOverride)try{this._config.dragImageTranslateOverride(void 0,void 0,void 0,function(){})}catch(e){O&&console.log("dnd-poly: error in dragImageTranslateOverride hook: "+e)}if(0===this._dragOperationState)return void this._cleanup();t.preventDefault(),this._dragOperationState="touchcancel"===t.type?3:2}},t.prototype._dragAndDropProcessModelIteration=function(){var t=this;if(O)var e=L+"debug",r=L+"immediate-user-selection",a=L+"current-drop-target";var o=this._currentDragOperation;this._dragDataStore._mode=3,this._dataTransfer.dropEffect=C[0];var n=T("drag",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer);if(n&&(O&&console.log("dnd-poly: drag event cancelled."),this._currentDragOperation=C[0]),n||2===this._dragOperationState||3===this._dragOperationState){var i=this._dragOperationEnded(this._dragOperationState);return i?void v(this._sourceNode,this._dragImage,this._dragImageTransforms,function(){t._finishDragOperation()}):void this._finishDragOperation()}var s=document.elementFromPoint(this._currentHotspotCoordinates.x,this._currentHotspotCoordinates.y);O&&console.log("dnd-poly: new immediate user selection is: "+s);var d=this._currentDropTarget;s!==this._immediateUserSelection&&s!==this._currentDropTarget&&(O&&(this._immediateUserSelection&&this._immediateUserSelection.classList.remove(r),s&&(s.classList.add(e),s.classList.add(r))),this._immediateUserSelection=s,null!==this._currentDropTarget&&(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=C[0],T("dragexit",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)),null===this._immediateUserSelection?(this._currentDropTarget=this._immediateUserSelection,O&&console.log("dnd-poly: current drop target changed to null")):(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=y(this._dragDataStore._effectAllowed,this._sourceNode),T("dragenter",this._immediateUserSelection,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?(O&&console.log("dnd-poly: dragenter default prevented"),this._currentDropTarget=this._immediateUserSelection,this._currentDragOperation=D(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect)):this._immediateUserSelection!==document.body&&(this._currentDropTarget=document.body))),d!==this._currentDropTarget&&l(d)&&(O&&d.classList.remove(a),O&&console.log("dnd-poly: current drop target changed."),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=C[0],T("dragleave",d,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1,this._currentDropTarget)),l(this._currentDropTarget)&&(O&&(this._currentDropTarget.classList.add(e),this._currentDropTarget.classList.add(a)),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=y(this._dragDataStore._effectAllowed,this._sourceNode),T("dragover",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)===!1?(O&&console.log("dnd-poly: dragover not prevented on possible drop-target."),this._currentDragOperation=C[0]):(O&&console.log("dnd-poly: dragover prevented."),this._currentDragOperation=D(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect))),O&&console.log("dnd-poly: d'n'd iteration ended. current drag operation: "+this._currentDragOperation),o!==this._currentDragOperation&&this._dragImage.classList.remove(L+o);var c=L+this._currentDragOperation;this._dragImage.classList.contains(c)===!1&&this._dragImage.classList.add(c)},t.prototype._dragOperationEnded=function(t){if(O&&console.log("dnd-poly: drag operation end detected with "+this._currentDragOperation),O){var e=L+"immediate-user-selection",r=L+"current-drop-target";this._currentDropTarget&&this._currentDropTarget.classList.remove(r),this._immediateUserSelection&&this._immediateUserSelection.classList.remove(e)}var a=this._currentDragOperation===C[0]||null===this._currentDropTarget||3===t;return a?l(this._currentDropTarget)&&(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=C[0],T("dragleave",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)):l(this._currentDropTarget)&&(this._dragDataStore._mode=1,this._dataTransfer.dropEffect=this._currentDragOperation,this._currentDragOperation=T("drop",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)===!0?this._dataTransfer.dropEffect:C[0]),a},t.prototype._finishDragOperation=function(){O&&console.log("dnd-poly: dragimage snap back transition ended"),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=this._currentDragOperation,T("dragend",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1),this._dragOperationState=2,this._cleanup()},t}(),N=function(){function t(t,e){this._dataStore=t,this._setDragImageHandler=e,this._dropEffect=C[0]}return Object.defineProperty(t.prototype,"types",{get:function(){return 0!==this._dataStore._mode?Object.freeze(this._dataStore._types):void 0},enumerable:!0,configurable:!0}),t.prototype.setData=function(t,e){if(2===this._dataStore._mode){if(t.indexOf(" ")>-1)throw new Error("illegal arg: type contains space");this._dataStore._data[t]=e,-1===this._dataStore._types.indexOf(t)&&this._dataStore._types.push(t)}},t.prototype.getData=function(t){return 1===this._dataStore._mode||2===this._dataStore._mode?this._dataStore._data[t]||"":void 0},t.prototype.clearData=function(t){if(2===this._dataStore._mode){if(t&&this._dataStore._data[t]){delete this._dataStore._data[t];var e=this._dataStore._types.indexOf(t);return void(e>-1&&this._dataStore._types.splice(e,1))}this._dataStore._data={},this._dataStore._types=[]}},t.prototype.setDragImage=function(t,e,r){2===this._dataStore._mode&&this._setDragImageHandler(t,e,r)},Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._dataStore._effectAllowed},set:function(t){2===this._dataStore._mode&&b.indexOf(t)>-1&&(this._dataStore._effectAllowed=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){0!==this._dataStore._mode&&b.indexOf(t)>-1&&(this._dropEffect=t)},enumerable:!0,configurable:!0}),t}(),H={DEBUG:O,Initialize:a};t.DragDropPolyfill=H,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=drag-drop-polyfill.min.js.map